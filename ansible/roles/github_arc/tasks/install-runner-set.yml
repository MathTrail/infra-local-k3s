---
- name: Install ARC runner scale set via Helm
  kubernetes.core.helm:
    kubeconfig: "{{ k3s_kubeconfig }}"
    context: "{{ k3s_context }}"
    name: "{{ runner_scale_set_name }}"
    chart_ref: "{{ arc_runner_set_chart }}"
    chart_version: "{{ arc_runner_set_version }}"
    release_namespace: "{{ arc_runners_namespace }}"
    create_namespace: false
    wait: true
    wait_timeout: "{{ arc_wait_timeout }}"
    values: "{{ lookup('template', 'runner-values.yml.j2') | from_yaml }}"
    state: present

- name: Display runner scale set status
  ansible.builtin.debug:
    msg: "Runner scale set '{{ runner_scale_set_name }}' installed in namespace '{{ arc_runners_namespace }}'"
